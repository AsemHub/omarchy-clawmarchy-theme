---
phase: 03-color-system-traceability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - btop.theme
  - hyprland.conf
  - hyprlock.conf
  - mako.ini
  - neovim.lua
  - chromium.theme
  - waybar.css
  - walker.css
  - swayosd.css
  - vscode.json
  - colors.toml
autonomous: true
requirements:
  - FNDTN-03
  - CLR-01
  - CLR-02

must_haves:
  truths:
    - "Every hardcoded color value in every static override file has an inline comment identifying its colors.toml source key"
    - "Every config file has a header classification line stating its maintenance model (static override requiring manual update)"
    - "Unmapped color values are explicitly flagged as UNMAPPED or DERIVED with rationale"
    - "colors.toml has a header comment identifying it as the source of truth"
    - "No color values are accidentally modified during annotation -- only comments added"
  artifacts:
    - path: "btop.theme"
      provides: "33 color values annotated with colors.toml key mappings"
      contains: "colors.toml:"
    - path: "hyprland.conf"
      provides: "2 color values annotated with colors.toml key mappings"
      contains: "colors.toml:"
    - path: "hyprlock.conf"
      provides: "7 color values annotated with colors.toml key mappings"
      contains: "colors.toml:"
    - path: "mako.ini"
      provides: "5 color values annotated with colors.toml key mappings"
      contains: "colors.toml:"
    - path: "neovim.lua"
      provides: "4 color values annotated, 2 flagged as UNMAPPED"
      contains: "colors.toml:"
    - path: "vscode.json"
      provides: "30 color values documented via _comment_* keys"
      contains: "_comment_"
    - path: "waybar.css"
      provides: "2 missing tooltip annotations completed"
      contains: "colors.toml: background"
    - path: "colors.toml"
      provides: "Header comment identifying this as the palette source of truth"
      contains: "Source of truth"
  key_links:
    - from: "btop.theme"
      to: "colors.toml"
      via: "inline # comments"
      pattern: "colors\\.toml:"
    - from: "vscode.json"
      to: "colors.toml"
      via: "_comment_* JSON keys"
      pattern: "_comment_"
    - from: "hyprlock.conf"
      to: "colors.toml"
      via: "inline # comments on rgba() values"
      pattern: "colors\\.toml:"
---

<objective>
Add inline color source annotations and file classification headers to all theme config files.

Purpose: Every hardcoded color value becomes traceable to its colors.toml palette key via a greppable `colors.toml: keyname` comment pattern. Every file gets a header line stating its maintenance model so contributors know what requires manual updates when colors change.

Output: All 10 static override config files annotated with per-value source comments and classification headers. colors.toml annotated as the source of truth. No color values modified -- only comments added.
</objective>

<execution_context>
@/home/asem/.claude/get-shit-done/workflows/execute-plan.md
@/home/asem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-color-system-traceability/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Annotate hash-comment config files and colors.toml</name>
  <files>btop.theme, hyprland.conf, hyprlock.conf, mako.ini, neovim.lua, chromium.theme, colors.toml, waybar.css, walker.css, swayosd.css</files>
  <action>
Add inline color source annotations and header classification lines to all config files that support native comments (hash `#`, Lua `--`, CSS `/* */`). Also add a source-of-truth header to colors.toml.

**colors.toml** -- Add a header comment block:
```
# Clawmarchy Theme - Color Palette
# Source of truth -- all other theme files reference these values
# Omarchy's template engine reads this file to generate terminal colors
# When changing values here, update all static override files (see COLORS.md)
```
Do NOT annotate individual key-value lines (circular -- this IS the source).

**btop.theme** (33 values) -- Add/update header:
```
# Clawmarchy btop theme - System Monitor Colors
# Static override -- must be manually updated when accent/palette changes
# Update: Manual -- accent changes affect 7 values, palette changes affect all
```
Then annotate each color value line. Use section comments to group identical values:
- Box outline colors (cpu_box, mem_box, net_box, proc_box) all use accent `#7B6CBD` -- annotate as a group: `# Box outline colors -- all use colors.toml: accent`
- Gradient sequences (cpu_start/mid/end, etc.) annotate individually since they use different colors
- For theme[main_bg]="#000000" use `# colors.toml: background`
- For theme[main_fg]="#E8E0D0" use `# colors.toml: foreground`
- Follow the pattern from 03-RESEARCH.md "btop.theme Annotation Pattern" section
- Every hex value must have a `# colors.toml: keyname` annotation (inline or section header)

**hyprland.conf** (2 values) -- Add header classification line near existing header:
```
# Update: Manual -- accent changes affect border color; palette changes affect shadow color
```
Annotate:
- `$activeBorderColor = rgb(7B6CBD)` -> add `# colors.toml: accent (rgb format without #)`
- Shadow color `rgba(00000088)` -> add `# colors.toml: background (shadow, 53% alpha)`

**hyprlock.conf** (7 values) -- Add header classification line:
```
# Update: Manual -- accent changes affect outer_color and check_color; palette changes affect all
```
Annotate each `$variable = rgba(...)` line with its colors.toml mapping:
- `$color = rgba(0,0,0, 1.0)` -> `# colors.toml: background (full opacity)`
- `$inner_color = rgba(0,0,0, 0.8)` -> `# colors.toml: background (80% opacity)`
- `$outer_color = rgba(123,108,189, 1.0)` -> `# colors.toml: accent (rgba decimal)`
- `$font_color = rgba(232,224,208, 1.0)` -> `# colors.toml: foreground (rgba decimal)`
- `$check_color = rgba(123,108,189, 1.0)` -> `# colors.toml: accent (rgba decimal)`
- Wallpaper dimming overlay `rgba(0,0,0,0.45)` -> `# colors.toml: background (45% overlay for wallpaper dimming)`
- Any clock color rgba -> annotate with its source key

**mako.ini** (5 values) -- IMPORTANT: First verify whether mako supports inline `#` comments (try adding `# test` after a value and check if mako still parses correctly). If inline comments are NOT supported, use line-above annotation format:
```
# colors.toml: foreground
text-color=#E8E0D0
```
If inline comments ARE supported, use:
```
text-color=#E8E0D0  # colors.toml: foreground
```
Add header classification:
```
# Update: Manual -- accent changes affect border-color; palette changes affect all colors
```
Annotate all 5 values: text-color (foreground), border-color (accent), background-color (background with FF alpha), and urgency-specific colors.

**neovim.lua** (4 values) -- Add header comment after the return statement's opening:
```
-- Clawmarchy Neovim AMOLED Overrides
-- Static override -- must be manually updated when palette changes
-- Update: Manual -- accent changes do NOT affect this file (only background overrides)
```
Annotate:
- `colors.bg = "#000000"` -> `-- colors.toml: background`
- `colors.bg_dark = "#000000"` -> `-- colors.toml: background`
- `colors.bg_float = "#0a0a12"` -> `-- UNMAPPED: tokyonight-specific dark surface (intentional, not in colors.toml)`
- `colors.bg_sidebar = "#0a0a12"` -> `-- UNMAPPED: tokyonight-specific dark surface (intentional, not in colors.toml)`

**chromium.theme** (1 value) -- IMPORTANT: This file is read by `omarchy-theme-set-browser` via `$(<file)` which captures entire file content. Adding comments WILL BREAK the script because the comment text becomes part of the RGB value. Do NOT add any comments to this file. Instead, create a companion annotation approach: the COLORS.md reference doc (Plan 03-02) will document this file's color mapping. If possible, check if a comment on a line BEFORE the RGB triplet is safe (the `$(<file)` command captures all lines). If it captures all lines, do NOT add any comments. Document this format restriction.

**waybar.css** -- Complete the 2 missing tooltip annotations (lines in the tooltip section):
```css
tooltip {
  background-color: #000000;  /* colors.toml: background */
  color: #E8E0D0;  /* colors.toml: foreground */
}
```
Add header classification line near existing header:
```
/* Update: Manual -- accent changes affect 2 values; palette changes affect all */
```

**walker.css** -- Already fully annotated (6/6 values). Only add header classification:
```
/* Update: Manual -- accent changes affect 2 values; palette changes affect all */
```

**swayosd.css** -- Already fully annotated (5/5 values). Only add header classification:
```
/* Update: Manual -- accent changes affect 1 value; palette changes affect all */
```

**After ALL annotations:**
1. Run `git diff` to verify NO color values were accidentally changed -- only comments/whitespace should be added
2. Run `python3 -m json.tool vscode.json > /dev/null` to verify JSON is not yet modified (vscode.json is Task 2)
3. Visually confirm each file has both: (a) header classification line and (b) per-value annotations
  </action>
  <verify>
Run `grep -r "colors.toml:" btop.theme hyprland.conf hyprlock.conf mako.ini neovim.lua waybar.css walker.css swayosd.css colors.toml` -- every annotated file should have matches. Run `grep "UNMAPPED" neovim.lua` -- should show 2 matches. Run `grep -c "colors.toml:" btop.theme` -- should be >= 20 (section headers plus individual annotations). Run `git diff --stat` to confirm only expected files changed. Run `git diff` and verify no hex value lines were modified (only comment additions).
  </verify>
  <done>
All 10 hash/Lua/CSS-comment config files have inline `colors.toml: keyname` annotations on every hardcoded color value. Each file has a header classification line identifying it as a static override with manual update requirements. colors.toml has a source-of-truth header. No color values were accidentally modified. Unmapped values in neovim.lua are flagged as UNMAPPED with rationale.
  </done>
</task>

<task type="auto">
  <name>Task 2: Annotate vscode.json with _comment keys</name>
  <files>vscode.json</files>
  <action>
Add per-group `_comment_*` keys inside the `[Tokyo Night]` scope of vscode.json's colorCustomizations, following the established `_comment` field pattern from Phase 2.

**Add these _comment keys inside the `"[Tokyo Night]"` object, before the first color key:**

```json
"_comment_backgrounds": "All #000000 values = colors.toml: background",
"_comment_foregrounds": "All #E8E0D0 values = colors.toml: foreground",
"_comment_accent": "#7B6CBD = colors.toml: accent; #7B6CBD40 = accent + 25% alpha; #7B6CBD30 = accent + 19% alpha",
"_comment_surfaces": "#111118 = colors.toml: color0 (dark surface); #2A2835 = colors.toml: color8 (dark border); #8A8598 = colors.toml: color7 (muted text)"
```

**Also update the top-level `_comment` field** to include the classification line. The existing `_comment` says colorCustomizations are not auto-applied. Append to it (or add a new `_comment_update` key):
```json
"_comment_update": "Static override -- accent changes affect 5 values; must be manually applied to VS Code settings.json"
```

**Validation:** After editing, run `python3 -m json.tool vscode.json > /dev/null` to verify JSON remains valid. Ensure no trailing commas and all strings are properly escaped.
  </action>
  <verify>
Run `python3 -m json.tool vscode.json > /dev/null && echo "valid JSON"` -- must print "valid JSON". Run `grep -c "_comment" vscode.json` -- should show at least 6 _comment entries (original _comment + _comment_update + 4 color group comments). Run `git diff vscode.json` and verify no color values changed, only _comment keys added.
  </verify>
  <done>
vscode.json has per-group `_comment_*` keys documenting all 30 color values by semantic role (backgrounds, foregrounds, accent, surfaces). The file has an update classification comment. JSON remains valid. No color values were modified.
  </done>
</task>

</tasks>

<verification>
1. Run `grep -rl "colors.toml:" btop.theme hyprland.conf hyprlock.conf mako.ini neovim.lua waybar.css walker.css swayosd.css colors.toml` -- should list all 9 files
2. Run `grep -l "_comment_backgrounds\|_comment_foregrounds\|_comment_accent\|_comment_surfaces" vscode.json` -- should match
3. Run `grep -rl "Static override\|Source of truth\|Manual" btop.theme hyprland.conf hyprlock.conf mako.ini neovim.lua waybar.css walker.css swayosd.css vscode.json colors.toml` -- all 11 files should have classification headers
4. Run `grep "UNMAPPED" neovim.lua` -- should show 2 lines for bg_float and bg_sidebar
5. Run `python3 -m json.tool vscode.json > /dev/null` -- must succeed
6. Run `git diff` -- confirm ONLY comments were added, no color values changed
</verification>

<success_criteria>
- Every hardcoded color value across all 10 static override files has an inline annotation mapping it to its colors.toml source key (or flagged as UNMAPPED/DERIVED)
- Every file has a header classification line identifying its maintenance model
- colors.toml has a source-of-truth header
- The annotation pattern `colors.toml: keyname` is greppable and consistent across all file types
- JSON validity preserved in vscode.json
- Zero accidental color value modifications
</success_criteria>

<output>
After completion, create `.planning/phases/03-color-system-traceability/03-01-SUMMARY.md`
</output>
